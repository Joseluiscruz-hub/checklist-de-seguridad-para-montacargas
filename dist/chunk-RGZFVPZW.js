import{N as c,ca as l}from"./chunk-HPYFT727.js";var d="ForkliftChecklistDB",b=2,n={SESSIONS:"sessions",INCIDENTS:"incidents"},i=class i{constructor(){this.db=null;this.dbInitialized=l(!1);this.initDb()}async initDb(){let t=indexedDB.open(d,b);t.onerror=e=>{console.error("Database error:",t.error)},t.onupgradeneeded=e=>{let r=e.target.result;r.objectStoreNames.contains(n.SESSIONS)||r.createObjectStore(n.SESSIONS,{keyPath:"id"}),r.objectStoreNames.contains(n.INCIDENTS)||r.createObjectStore(n.INCIDENTS,{keyPath:"id",autoIncrement:!0})},t.onsuccess=e=>{this.db=e.target.result,this.dbInitialized.set(!0),console.log("Database initialized successfully.")}}getStore(t,e){return this.db?this.db.transaction(t,e).objectStore(t):(console.error("Database is not initialized."),null)}saveSession(t){return new Promise((e,r)=>{let o=this.getStore(n.SESSIONS,"readwrite");if(!o)return r("Store not available");let s=o.put(t);s.onsuccess=()=>e(),s.onerror=()=>r(s.error)})}saveIncident(t){return new Promise((e,r)=>{let o=this.getStore(n.INCIDENTS,"readwrite");if(!o)return r("Store not available");let s=o.add(t);s.onsuccess=()=>e(),s.onerror=()=>r(s.error)})}getAllSessions(){return new Promise((t,e)=>{let r=this.getStore(n.SESSIONS,"readonly");if(!r)return e("Store not available");let o=r.getAll();o.onsuccess=()=>t(o.result),o.onerror=()=>e(o.error)})}clearDatabase(){return new Promise((t,e)=>{if(!this.db)return e("Database not initialized");let r=this.db.transaction(Object.values(n),"readwrite"),o=0,s=this.db.objectStoreNames.length;if(s===0)return t();for(let S of this.db.objectStoreNames){let a=r.objectStore(S).clear();a.onsuccess=()=>{o++,o===s&&t()},a.onerror=()=>e(r.error)}})}};i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=c({token:i,factory:i.\u0275fac,providedIn:"root"});var u=i;export{u as a};
