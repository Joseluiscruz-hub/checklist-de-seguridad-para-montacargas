import{a as S}from"./chunk-RGZFVPZW.js";import{$a as m,Ga as b,Qa as p,Ra as u,S as c,Z as v,Za as n,_a as i,ca as h,eb as I,fb as C,gb as f,hb as g,lb as r,ra as y,ya as x}from"./chunk-HPYFT727.js";var k=["passFailChart"],F=["commonIssuesChart"];function w(o,e){o&1&&(n(0,"p",6),r(1,"Cargando estad\xEDsticas..."),i())}function T(o,e){o&1&&(n(0,"div",7),m(1,"i",9),n(2,"p",10),r(3,"No hay datos disponibles para estad\xEDsticas."),i(),n(4,"p",11),r(5,"Complete inspecciones para ver los gr\xE1ficos aqu\xED."),i()())}function L(o,e){o&1&&(n(0,"div",8)(1,"div",12),m(2,"canvas",null,0),i(),n(4,"div",12),m(5,"canvas",null,1),i()())}function N(o,e){if(o&1&&p(0,T,6,0,"div",7)(1,L,7,0,"div",8),o&2){let t=I();u(t.hasData()?1:0)}}var l=class l{constructor(){this.dbService=c(S);this.injector=c(v);this.isLoading=h(!0);this.hasData=h(!1)}ngOnInit(){this.loadStats()}async loadStats(){this.isLoading.set(!0);let e=await this.dbService.getAllSessions();e.length>0?(this.hasData.set(!0),x(()=>{this.processData(e)},{injector:this.injector})):this.hasData.set(!1),this.isLoading.set(!1)}processData(e){let t=0,a=0,s={};e.forEach(_=>{_.inspections.forEach(E=>{E.checklist.some(d=>d.status==="issue")?a++:t++,E.checklist.forEach(d=>{d.status==="issue"&&(s[d.label]=(s[d.label]||0)+1)})})}),this.createPassFailChart(t,a),this.createCommonIssuesChart(s)}createPassFailChart(e,t){this.passFailChart&&this.passFailChart.destroy(),this.passFailChartCanvas?.nativeElement&&(this.passFailChart=new Chart(this.passFailChartCanvas.nativeElement,{type:"doughnut",data:{labels:["OK","Con Incidencias"],datasets:[{data:[e,t],backgroundColor:["#10B981","#EF4444"],borderColor:"#ffffff",borderWidth:2}]},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Estado General de Inspecci\xF3n"}}}}))}createCommonIssuesChart(e){if(this.commonIssuesChart&&this.commonIssuesChart.destroy(),!this.commonIssuesChartCanvas?.nativeElement)return;let t=Object.entries(e).sort(([,a],[,s])=>s-a).slice(0,5);this.commonIssuesChart=new Chart(this.commonIssuesChartCanvas.nativeElement,{type:"bar",data:{labels:t.map(([a])=>a),datasets:[{label:"N\xFAmero de Incidencias",data:t.map(([,a])=>a),backgroundColor:"#3B82F6"}]},options:{responsive:!0,indexAxis:"y",plugins:{legend:{display:!1},title:{display:!0,text:"Top 5 Incidencias Comunes"}}}})}};l.\u0275fac=function(t){return new(t||l)},l.\u0275cmp=b({type:l,selectors:[["app-stats"]],viewQuery:function(t,a){if(t&1&&(C(k,5),C(F,5)),t&2){let s;f(s=g())&&(a.passFailChartCanvas=s.first),f(s=g())&&(a.commonIssuesChartCanvas=s.first)}},decls:8,vars:1,consts:[["passFailChart",""],["commonIssuesChart",""],[1,"container","mx-auto","p-4","max-w-2xl"],[1,"mb-6"],[1,"text-3xl","font-bold","text-gray-800","dark:text-white"],[1,"text-gray-600","dark:text-gray-400"],[1,"text-center","text-gray-500","dark:text-gray-400"],[1,"text-center","py-10","bg-white","dark:bg-dark-card","rounded-lg","shadow"],[1,"space-y-8"],[1,"fas","fa-chart-line","text-4xl","text-gray-400","mb-4"],[1,"text-gray-500","dark:text-gray-400"],[1,"text-sm","text-gray-400","dark:text-gray-500"],[1,"bg-white","dark:bg-dark-card","rounded-lg","shadow","p-4"]],template:function(t,a){t&1&&(n(0,"div",2)(1,"header",3)(2,"h1",4),r(3,"Estad\xEDsticas"),i(),n(4,"p",5),r(5,"Visualice los datos de control de calidad."),i()(),p(6,w,2,0,"p",6)(7,N,2,1),i()),t&2&&(y(6),u(a.isLoading()?6:7))},encapsulation:2,changeDetection:0});var D=l;export{D as StatsComponent};
